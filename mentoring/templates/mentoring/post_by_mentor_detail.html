{% extends 'mentoring/base.html' %}
{% load bootstrap3 %}
{% load staticfiles %}
{% block content %}
{% csrf_token %}
<div class="container">

      <div class="row">

        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xs-offset-0 col-sm-offset-0 col-md-offset-3 col-lg-offset-3 toppad" >


        <div class="card" style="margin-top: 10%;">
          <div class="card-content">
          <div class="card-header"> <h3>{{post_by_mentor.author}}</h3>
            <h4 align="right">{{bid_by_mentee}}명이 현재 입찰중</h4> </div>
          </div>
          <div class="card-image">
            <img src="{{post_by_mentor.photo1.url}}">
          </div>
          <div class="card-content">
            <div class="card-header"><strong>제목:</strong> {{post_by_mentor.title}} </div>
          </div>
          <div class="card-content">
            <div class="card-header"><strong>멘토링 인원:</strong> {{post_by_mentor.capacity}}명 </div>
          </div>
          <div class="card-content">
            <div class="card-header"><strong>멘토링 시간:</strong> {{post_by_mentor.hours}}시간 </div>
          </div>
          <div class="card-content">
            <div class="card-header"><strong>멘토링 날짜:</strong> {{post_by_mentor.date}} </div>
          </div>
          <div class="card-content">
            <div class="card-header"><strong>최저 멘토링비:</strong> {{post_by_mentor.lowest_price}}원 </div>
          </div>
          <div class="card-content">
            <div class="card-header"><strong>소개글:</strong> {{post_by_mentor.intro}} </div>
          </div>
          <div class="card-content">
            <span class="pull-right"><i class="fa fa-heart"></i> {{like_count}} </span>
            <i class="fa fa-comment"></i> 3 comments
          </div>
          <div class="card-extra card-content">
            <div class="input-group">
              <input class="form-control" type="text" placeholder="Add comment...">
              <div class="input-group-btn">
                <a class="btn btn-inverted btn-default"><i class="fa fa-paper-plane"></i></a>
              </div>
            </div>
          </div>
          <div class="card=content">
            <div class="card-header">
            {% if post_by_mentor.author == user %}
            <h2>
            <span class="dropdown btn-group pull-right">
                <img src="{% static 'img/edit.png' %}" style="width: 40px;" id="edit">
                <img src="{% static 'img/delete.png' %}" style="width: 40px;" id="delete">
            </span>
            </h2>
            {% endif %}
            </div>
          </div>
        </div>
        </div>
      </div>



    <div class="container col-md-11 col-md-offset-1">

        {# 글 내용 부분 #}
        <div class="row col-sm-11">
            <hr>
            <p class = "lead">
                <i class="fa fa-clock-o"> Posted on {{post_by_mentor.created_at|date:'Y-m-d H:i'}}</i><br>
                <i class="fa fa-refresh"> Last updated on {{post_by_mentor.updated_at|date:'Y-m-d H:i'}}</i>
            </p>
            <hr>

            <form method="POST" enctype="multipart/form-data" class="text-center">
                {% csrf_token %}

                    <button type="submit" class="btn btn-primary btn-lg" onclick="window.open('bid/new','win','width=650,height=400')";>신청하기 <span class="badge">{{mentor.vote_set.count}}</span></button>

            </form>
            <hr>
        </div>



    {# 댓글 다는 부분 #}
        <div class="row col-sm-9 col-md-offset-1">
            <section class="comment">
                <article class="row">
                    <div class="col-sm-2 hidden-xs">
                        {# 개인 프로필 사진 넣기 #}
                        <figure class="thumbnail user-photo">
                            {% if account.extra_data.properties.profile_image %}
                                    <img src = {{account.extra_data.properties.profile_image}}>
                            {% else %}
                                    <img src = "https://ssl.gstatic.com/accounts/ui/avatar_2x.png">
                            {% endif %}
                            </figure>
                    </div>
                    <div class="col-sm-9">
                        <div class="comment-list">
                            <div class="panel panel-default arrow left">
                                <div class="panel-body">
                                    {# <form action="" method="POST" enctype="multipart/form-data"> #}
                                        {% for field in form %}
                                                {% bootstrap_field field %}
                                        {% endfor %}
                                        <div id="results"></div>
                                        <div style="display:none;" id="comment-footer">
                                            <button class="btn btn-primary btn-xs pull-right add_comment">확인</button>
                                            <span class="pull-right">&nbsp;</span>
                                            <button class="btn btn-danger btn-xs pull-right form-cancel">취소</button>
                                        </div>
                                    {# </form> #}
                                </div>
                            </div>
                        </div>
                    </div>
                </article>
            </section>
            <hr>
        </div>

    {# 댓글 보는 부분 #}
    <div class="row col-sm-9 col-md-offset-1 comment-block">
        {% if comments %}
        <section class="comment-list">
            {% for comment in comments %}
                <article class="row">
                    <div class="col-sm-2 hidden-xs">
                        {# ---프로필 사진이 들어갈 곳--- #}
                        <figure class="thumbnail user-photo">
                            {% if comment.author.socialaccount_set.all %}
                                {%for account in comment.author.socialaccount_set.all%}
                                    {% if account.extra_data.properties.profile_image %}
                                        <img src = {{account.extra_data.properties.profile_image}}>
                                    {% else %}
                                        <img src="https://ssl.gstatic.com/accounts/ui/avatar_2x.png">
                                    {%endif%}
                                {% endfor %}
                            {% else %}
                                <img src="https://ssl.gstatic.com/accounts/ui/avatar_2x.png" >
                            {%endif%}
                        </figure>
                    </div>
                    <div class="col-sm-9">
                        <div class="panel panel-default arrow left">
                            <div class="panel-body no-padding">
                                <header class="text-left">
                                    <div class="comment-user">
                                    {%if comment.author == user %}
                                    <div class="dropdown btn-group pull-right">
                                        <i class="fa fa-bars" aria-hidden="true" data-toggle="dropdown"></i>
                                        <ul class="dropdown-menu" style="min-width: 30px">
                                        <li><a href="javascript:void(0)" class="a_comment_edit">수정</a></li>
                                        <li><a href="{% url 'mentor:comment_del' mentor.pk comment.pk %}">삭제</a></li>
                                        </ul>
                                    </div>
                                    {% endif %}
                                    <i class="fa fa-user"></i>
                                        <strong>
                                        {% if comment.author.socialaccount_set.all %}
                                            {%for account in comment.author.socialaccount_set.all%}
                                                {% if account.provider == "facebook" %}
                                                    {{comment.author.last_name}}{{comment.author.first_name}}
                                                {% elif account.provider == "kakao" %}
                                                    {{comment.author.first_name}}
                                                {%endif%}
                                            {% endfor %}
                                        {% else %}
                                            {{comment.author}}
                                        {% endif %}
                                        </strong>
                                    </div>
                                    <time class="comment-date small text-muted">
                                        <i class="fa fa-clock-o"></i>
                                        {{comment.elapsed_time}}
                                        {% if comment.created_at|date:'YmdHms' != comment.updated_at|date:'YmdHms' %}
                                        (수정됨)
                                        {% endif %}
                                    </time>
                                </header>
                                {# <form action="" method="POST" enctype="multipart/form-data"> #}
                                    <input type="hidden" class="comment-pk" value="{{comment.pk}}">
                                    <div class="comment-post">
                                        <span class="comment-content">{{comment.contents}}</span>
                                    </div>
                                    <div class="comment-post-buttons" style="display:none">
                                        <button class="btn btn-primary btn-xs edit-submit">확인</button> <button class="btn btn-danger btn-xs edit-cancel">취소</button>
                                    </div>
                                {# </form> #}
                            </div>
                        </div>
                    </div>
                </article>
            {% endfor %}
        </section>
            {% else %}
                <div class="row col-xs-12">
                    댓글없음
                </div>
        {% endif %}
        </div>
    </div>
    </div>

{% endblock %}

{% block script %}
    <script>
        function edit(){
            return "{% static 'js/comment_edit.js' %}"
        }

      $(document).ready(function (){
            $('.page-heading.mentor').on('click', function (){
                location.href = '/mentor/'
            })
            $('#delete').on('click', function (){
                if (confirm('삭제하시겠습니까?'))
                    location.href = "{% url 'mentoring:post_by_mentor_delete' post_by_mentor.pk %}"
            })
            $('#edit').on('click', function (){
                location.href = "{% url 'mentoring:post_by_mentor_edit' post_by_mentor.pk %}"
            })
    })
    </script>
    <script src="{% static 'js/comment_edit.js' %}"></script>
    <script src="{% static 'js/comment_add.js' %}"></script>

{% endblock %}
